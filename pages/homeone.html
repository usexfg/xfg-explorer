

<style>

	#mem_pool_rows tr td:first-child {
		text-align: left;
	}
</style>
<!---------
<div class="row">
	<div class="col-sm-12 col-md-12">
		<div class="panel panel-default" style="background-color:#0000;margin-bottom:-15px;" id="network-stats">
		  <div class="panel-heading">
			<h3 class="panel-title"><i class="fa fa-tasks fa-fw" aria-hidden="true"></i> Stats</h3>
		  </div>
		  <div class="panel-body">
			<div class="row">
				<div class="col-sm-12 col-md-12" style="padding-right: 8px;">
					<ul class="list-group" style="display: inline-flex;padding-left: 21px;">
					
						<li class="list-group-item d-flex justify-content-between align-items-center" data-toggle="tooltip" data-placement="top" data-original-title="Blockchain height, total amount of blocks starting from zero."><i class="fa fa-list-ol" style="color: #ffc800;display:none;"></i> Height: <span id="networkHeight"></span></li>
				
						<li class="list-group-item d-flex justify-content-between align-items-center" data-toggle="tooltip" data-placement="top" data-original-title="The number of transactions in the network (excluding coinbase, i.e. reward for mined blocks)."><i class="fa fa fa-exchange" style="color: #ffc800;display:none;"></i> Transactions: <span id="networkTransactions"></span></li>
						
			
						
						<li class="list-group-item d-flex justify-content-between align-items-center" data-toggle="tooltip" data-placement="top" data-original-title="Current Base Reward (for last mined block)."><i class="fa fa-cube" style="color: #ffc800;display:none;"></i> Reward: <span id="currentReward"></span></li>
						
						<li class="list-group-item d-flex justify-content-between align-items-center" data-toggle="tooltip" data-placement="top" data-original-title="Amount of XFG mined & circulating thus far."><i class="fa fa-diamond" style="color:#82dffe"></i> Supply: <span id="totalCoins"></span></li>
						
						<li class="list-group-item d-flex justify-content-between align-items-center" data-toggle="tooltip" data-placement="bottom" data-original-title="Percent of mined XFG in circulation related to total supply of 8 Million ."><i class="fa fa-hourglass-half" aria-hidden="true" style="color: #ffc800;display:none;"></i> Emission: <span id="emissionPercent"></span> %</li>
						
					</ul>
				</div>
				<div class="col-sm-6 col-md-6" style="padding-left: 15px;padding-right: 8px; display: none;">
					<ul class="list-group">
					
						<li class="list-group-item d-flex justify-content-between align-items-center" data-toggle="tooltip" data-placement="top" data-original-title="Difficulty for next block. Ratio of which, at the current hashing speed, blocks will be mined at 8 minute intervals."><i class="fa fa-unlock-alt"style="color: #ffc800;"></i> Difficulty: <span id="networkDifficulty"></span></li>
				
						<li class="list-group-item d-flex justify-content-between align-items-center" data-toggle="tooltip" data-placement="top" data-original-title="Average difficulty by last 30 blocks."><i class="fa fa-lock"style="color: #ffc800;"></i> Avg Difficulty: <span id="avgDifficulty"></span></li>
					
					
						<li class="list-group-item d-flex justify-content-between align-items-center" data-toggle="tooltip" data-placement="top" data-original-title="Current estimated network hash rate. Calculated by current difficulty."><i class="fa fa-tachometer"style="color: #ffc800;"></i> Hash Rate: <span id="networkHashrate"></span></li>
						
						<li class="list-group-item d-flex justify-content-between align-items-center" data-toggle="tooltip" data-placement="top" data-original-title="Average estimated network hash rate. Calculated by average difficulty."><i class="fa fa-clock-o"style="color: #ffc800;"></i> Avg Hash Rate: <span id="avgHashrate"></span></li>

						<li class="list-group-item d-flex justify-content-between align-items-center" data-toggle="tooltip" data-placement="bottom" data-original-title="Estimated block solve time at estimated network speed and current difficulty."><i class="fa fa-circle-o-notch" aria-hidden="true"style="color: #ffc800;"></i> Solve time: <span id="blockSolveTime"></span></li>
					
					</ul>
				</div>
			</div>
			
		  </div>
		</div>
	</div>
------>
	<div class="col-sm-12 col-md-12">
		<div class="panel panel-default">
		  <div class="panel-heading">
		  
			<h2 style="margin-top:10px;color:ivory"class="panel-title"><i class="fa fa-bar-chart" aria-hidden="true"></i> Transactions
		  
			<span class="text-default" data-toggle="tooltip" data-placement="right" data-original-title="Block size and transactions count based on recent block list below.  Load more blocks to enlarge chart range."><i class="fa fa-question-circle"></i></span>
			</h3>
			
		  </div>
		  <div class="panel-body chart-wrapper">
			<canvas id="difficultyChart" height="225"></canvas>
		  </div>
		</div>
	</div>
</div>


<div style="background-color:transparent;"class="panel panel-default">
<input type="button" class="btn btn-default btn-xs pull-right" value="☰" onclick="tra()" style="border-radius: 8px;font-size:8px;">
  <div class="panel-heading"> 
	<h3 style=""class="panel-title"><i class="fa fa-exchange fa-fw" aria-hidden="true"></i> Transaction pool 
<span id="mempool_count" class="badge"></span>
	<span class="text-default" data-toggle="tooltip" data-placement="right" data-original-title="Recent transactions waiting to be included into a block. Once it happens a transaction gets into the blockchain and becomes confirmed."><i class="fa fa-question-circle"></i></span>
    </h3>
	
  </div>
		
		<div class="row"style="box-shadow: 0px -45px 2000px 21px #29d7ff;margin-bottom: 33px;border-radius: 21px;background-color:#090046;color:#11baff;">
<!---		  <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3"style="margin-left: 45px;">
			<div class="panel panel-default tab-panel"style="margin-bottom: 0px;border-radius: 45px;">
			  <div class="panel-body">
				
				  <ul class="nav nav-pills nav-stacked">
				<li data-toggle="tooltip" data-placement="bottom" data-original-title="">Count: <span id="mempool_count"></span></li> 
				  </ul>
				
			  </div>
			</div>
		  </div>
		  <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3"style="padding-left: 0;margin-inline-start: -53px;">
			<div class="panel panel-default tab-panel"style="margin-bottom: 0px;border-radius: 45px;">
			  <div class="panel-body">
				
				  <ul class="nav nav-pills nav-stacked" style="margin-left: -18px;">
					<li data-toggle="tooltip" data-placement="bottom" data-original-title="">Total Amount: <span id="mempool_amount"></span></li>
				  </ul>
				
			  </div>
			</div>
		  </div>
		  <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3"style="padding-right: 0;">
			<div class="panel panel-default tab-panel"style="margin-bottom: 0px;border-radius: 45px;">
			  <div class="panel-body">
				
				  <ul class="nav nav-pills nav-stacked">
					<li href="javascript:void(0);" data-toggle="tooltip" data-placement="bottom" data-original-title="">Total Fees: <span id="mempool_fees"></span></a></li>
				  </ul>
				
			  </div>
			</div>
		  </div>
		  <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3">
		    <div class="panel panel-default tab-panel"style="margin-bottom: 0px;border-radius: 45px;">
		      <div class="panel-body">
			    
			      <ul class="nav nav-pills nav-stacked">
				    <li data-toggle="tooltip" data-placement="bottom" data-original-title="">Total Size: <span id="mempool_sizes"></span></li>
			      </ul>
			   
		      </div>
			</div>
		  </div> --->
  <div id="tradiv" class="panel-body"style="display:none;width:90%;">

		<div style="font-family:Lato;width:111%;" class="table-responsive">
			<table class="table table-hover" id="mem_pool_table">
				<thead>
				<tr>
				<!--	<th style="background-color: #b6e4ec33;border-top-left-radius: 42px;" width="30%"><i class="fa fa-clock-o"></i> Date &amp; time</th> --->
					<th style="background-color: #b6e4ec33;" width="10%"><i class="fa fa-money"></i> Amount</th>
					<th style="background-color: #b6e4ec33;" width="10%"><i class="fa fa-tag"></i> Fee</th>
					<th style="background-color: #b6e4ec33;" width="10%"><i class="fa fa-archive"></i> Size</th>
					<th style="background-color: #b6e4ec33;border-top-right-radius: 42px;" width="40%"><i class="fa fa-paw"></i> Hash</th>
				</tr>
				</thead>
				<tbody id="mem_pool_rows">
					
				</tbody>
			</table>  
		</div>  
	</div>
</div>
</div>

<div class="panel panel-default">
  <div class="panel-body">
<div class="row" style="background-color: black;border-radius: 16px;border: 1px solid black;margin-top: 20px;">
<h4 class="panel-title" style="padding-right: 95px;margin-left: 20px;margin-top: 7px;color:goldenrod;"><i class="fa fa-chain fa-rotate-270 fa-fw" aria-hidden="true"></i> Recent blocks</h4>
		<div class="col-sm-8 col-md-6 col-lg-5">
			<div class="input-group">
				<a id="prev-page" href="#" class="btn btn-default input-group-addon"><i class="fa fa-arrow-left" aria-hidden="true"></i> Older</a>
				<span class="input-group-addon">№</span>
				<input id="goto-height" type="text" class="form-control" placeholder="Height">
				<a id="goto-height-go" href="#" class="btn btn-default input-group-addon">Go</a>
				<a id="next-page" href="#" class="btn btn-default input-group-addon disabled">Newer <i class="fa fa-arrow-right" aria-hidden="true"></i></a>
			</div>
		</div>
	</div>

	<div style="font-family:Lato;"class="table-responsive">
		<table class="table table-hover">
			<thead>
			<tr>
				<th><i class="fa fa-bars"></i> Height</th>
				<th><i class="fa fa-clock-o"></i> Date &amp; time</th>
				<th><i class="fa fa-archive"></i> Size</th>
				<th><i class="fa fa-paw"></i> Block Hash</th>
				<th><i class="fa fa-unlock-alt"></i> Difficulty</th>
				<th><i class="fa fa fa-exchange"></i> Txs</th>
			</tr>
			</thead>
			<tbody id="blocks_rows">

			</tbody>
		</table>
	</div>

	<p class="text-center">
		<button type="button" class="btn btn-default" id="loadMoreBlocks">Load More</button>
	</p>
	
  </div>
</div>
<script>
var block,
	Difficulties = [],
	Blocks = [],
	Rewards = [],
	Txses = [],
	Sizes = [],
	Timestamps = [],
	time_stamps = [],
	Solvetimes = [],
	diffChart,
	refresh = true;
currentPage = {
        destroy: function(){
            if (xhrGetBlocks) xhrGetBlocks.abort();
        },
        init: function(){
			$.when(
				renderInitialBlocks()
			).then(function() {
				setTimeout(function(){
					$.when(
						displayDiffChart()
					).then(function() {
						setTimeout(function(){
							refreshChart();
						}, 100)
					});
				}, 500)
			});
        },
        update: function(){
			if (!lastStats || typeof lastStats.height === 'undefined' || typeof lastStats.tx_count === 'undefined' || typeof lastStats.difficulty === 'undefined' || typeof lastStats.last_known_block_index === 'undefined') {
				console.error("lastStats is not ready or missing required properties");
				return;
			}
			renderLastBlock();
            updateText('networkHeight', lastStats.height.toString());
            updateText('networkTransactions', lastStats.tx_count.toString());
            updateText('networkHashrate', getReadableHashRateString(lastStats.difficulty / blockTargetInterval));
            updateText('networkDifficulty', getReadableDifficultyString(lastStats.difficulty, 2).toString());
			$("time.timeago").timeago();
			getPoolTransactions();
			var currHeight = $('#blocks_rows').children().first().data('height');
			if(refresh){
				$.when(
					renderInitialBlocks()
				).then(function() {
					setTimeout(function(){
						refreshChart();
					}, 100)
				});
			}
			if((currHeight + 31) < lastStats.last_known_block_index){
				$('#next-page').removeClass('disabled');
			}
		}
};

function renderLastBlock(){
$.ajax({
    url: api + '/json_rpc',
    method: "POST",
    data: JSON.stringify({
          jsonrpc:"2.0",
          id: "test",
          method:"getlastblockheader",
          params: {
  
                }
    }),
    dataType: 'json',
    cache: 'false',
    success: function(data){
		last_block_hash = data.result.block_header.hash;
		$.ajax({
			url: api + '/json_rpc',
			method: "POST",
			data: JSON.stringify({
				jsonrpc:"2.0",
				id: "test",
				method:"f_block_json",
				params: {
				    hash: last_block_hash
				}
			}),
			dataType: 'json',
			cache: 'false',
			success: function(data){
			block = data.result.block;
				updateText('totalCoins', getReadableCoins(block.alreadyGeneratedCoins,2));
				updateText('emissionPercent', (block.alreadyGeneratedCoins / 80000088000008 * 100).toFixed(4));
				updateText('currentReward', getReadableCoins(block.baseReward,4));
			}
		});
    }
});
}

var xhrGetBlocks;
$('#loadMoreBlocks').click(function(){
    if (xhrGetBlocks) xhrGetBlocks.abort();
        xhrGetBlocks = $.ajax({
            url: api + '/json_rpc',
            method: "POST",
            data: JSON.stringify({
                jsonrpc:"2.0",
                id: "test",
                method:"f_blocks_list_json",
                params: {
                    height: $('#blocks_rows').children().last().data('height')
                }
            }),
            dataType: 'json',
            cache: 'false',
            success: function(data){
                                $.when(
                                         renderBlocks(data.result.blocks)
                                ).then(function() {
                                        setTimeout(function(){
                                                loadMoreChart();
                                        }, 100)
                                });
            }
    });
});
$('#prev-page').click(function(e){
        refresh = false;
    if (xhrGetBlocks) xhrGetBlocks.abort();
        var currHeight = $('#blocks_rows').children().first().data('height');
        var openHeight = (currHeight - 31 < 0) ? 0 : currHeight - 31;

        xhrGetBlocks = $.ajax({
            url: api + '/json_rpc',
            method: "POST",
            data: JSON.stringify({
                jsonrpc:"2.0",
                id: "test",
                method:"f_blocks_list_json",
                params: {
                    height: openHeight
                }
            }),
            dataType: 'json',
            cache: 'false',
            success: function(data){
                                $('#blocks_rows').children().remove();
                                $.when(
                                        renderBlocks(data.result.blocks)
                                ).then(function() {
                                        setTimeout(function(){
                                                refreshChart();
                                        }, 100)
                                });
            }
    });
        e.preventDefault();

        if((currHeight + 31) > lastStats.last_known_block_index){
                $('#next-page').removeClass('disabled');
        }
        if((currHeight - 61) < 0){
                $('#prev-page').addClass('disabled');
        }
});
$('#next-page').click(function(e){
        refresh = false;
    if (xhrGetBlocks) xhrGetBlocks.abort();
        var currHeight = $('#blocks_rows').children().first().data('height');
        var openHeight = (currHeight + 31 > lastStats.last_known_block_index) ? (lastStats.last_known_block_index) : currHeight + 31;

        xhrGetBlocks = $.ajax({
            url: api + '/json_rpc',
            method: "POST",
            data: JSON.stringify({
                jsonrpc:"2.0",
                id: "test",
                method:"f_blocks_list_json",
                params: {
                    height: openHeight
                }
            }),
            dataType: 'json',
            cache: 'false',
            success: function(data){
                                $('#blocks_rows').children().remove();
                                $.when(
                                        renderBlocks(data.result.blocks)
                                ).then(function() {
                                        setTimeout(function(){
                                                refreshChart();
                                        }, 100)
                                });
            }
    });
        e.preventDefault();

        if((currHeight + 61) > lastStats.last_known_block_index){
                $('#next-page').addClass('disabled');
                refresh = true;
        }

                $('#prev-page').removeClass('disabled');

});
$('#goto-height-go').click(function() {
        var height = document.getElementById('goto-height').value;
        var newUrl = "/?height="+height;
        window.location = newUrl;
});
$('#goto-height').keyup(function(e){
        if(e.keyCode === 13)
            $('#goto-height-go').click();
});
    function renderInitialBlocks(){
		if (!lastStats || typeof lastStats.last_known_block_index === 'undefined') {
			console.error("lastStats is not ready or missing last_known_block_index");
			return;
		}
        if (xhrGetBlocks) xhrGetBlocks.abort();

                var loadHeight;

                if (urlParam('height'))
                                loadHeight = parseInt(urlParam('height'));
            else
                                loadHeight = lastStats.height - 1;

                if((loadHeight - 31) < 0){
                        $('#prev-page').addClass('disabled');
                        $('#next-page').removeClass('disabled');
                }

                        xhrGetBlocks = $.ajax({
                                url: api + '/json_rpc',
                                method: "POST",
                                data: JSON.stringify({
                                        jsonrpc:"2.0",
                                        id: "test",
                                        method:"f_blocks_list_json",
                                        params: {
                                                height: loadHeight
                                        }
                                }),
                                dataType: 'json',
                                cache: 'false',
                                success: function(data){
                                        renderBlocks(data.result.blocks);
                                }
                        });
    };






    function getBlockRowElement(block, jsonString){
        var row = document.createElement('tr');
        row.setAttribute('data-json', jsonString);
        row.setAttribute('data-height', block.height);
        row.setAttribute('id', 'blockRow' + block.height);
        row.setAttribute('title', block.hash);
		var dateTime = new Date(block.timestamp * 1000).toISOString();
		row.setAttribute('data-dt', dateTime);
        var columns =
            '<td>' + block.height + '</td>' +
            '<td class="date-time">' + formatDate(block.timestamp) + ' (<time class="timeago" datetime="'+dateTime+'"></time>)</td>' +
			'<td>' + formatBytes(parseInt(block.cumul_size)) + '</td>' +
			'<td>' + formatBlockLink(block.hash) + '</td>' +
            '<td class="blk-diff">' + block.difficulty + '</td>' +
            '<td>' + block.tx_count + '</td>';
		Difficulties.push(parseInt(block.difficulty));
		Blocks.push(parseInt(block.height));
		Txses.push(parseInt(block.tx_count));
		Sizes.push(parseInt(block.cumul_size));
		Timestamps.push(dateTime);
		time_stamps.push(block.timestamp);
        row.innerHTML = columns;
		
        return row;
    }
    function renderBlocks(blocksResults){
        var $blocksRows = $('#blocks_rows');
        for (var i = 0; i < blocksResults.length; i ++){
            var block = blocksResults[i];
            var blockJson = JSON.stringify(block);
            var existingRow = document.getElementById('blockRow' + block.height);
            if (existingRow && existingRow.getAttribute('data-json') !== blockJson){
                $(existingRow).replaceWith(getBlockRowElement(block, blockJson));
            }
            else if (!existingRow){
                var blockElement = getBlockRowElement(block, blockJson);
                var inserted = false;
                var rows = $blocksRows.children().get();
                for (var f = 0; f < rows.length; f++) {
                    var bHeight = parseInt(rows[f].getAttribute('data-height'));
                    if (bHeight < block.height){
                        inserted = true;
                        $(rows[f]).before(blockElement);
                        break;
                    }
                }
                if (!inserted) {
                    $blocksRows.append(blockElement);
				}
            }
        }
		$("time.timeago").timeago();
		calcAvgHashRate();
		calcAvgSolveTime();
    }
	function calcAvgHashRate(){
		var sum = Difficulties.reduce(add, 0);
		function add(a, b) {
			return a + b;
		}
		var avgDiff = Math.round(sum / Difficulties.length);
		var avgHashRate = avgDiff / blockTargetInterval;
		
		updateText('avgDifficulty', getReadableDifficultyString(avgDiff, 2).toString());
		updateText('avgHashrate', getReadableHashRateString(avgDiff / blockTargetInterval));
        updateText('blockSolveTime', getReadableTime(lastStats.difficulty / avgHashRate));
	}
	
	function calcAvgSolveTime(){ 
		ts = time_stamps.concat([]);
		ts.sort();
		var avg_solve_time = 0;
		var solveTime = 0;
		for (var i = 1; i < ts.length; i++){
			solveTime += ts[i] - ts[i - 1];
		}
		avg_solve_time = solveTime / (ts.length - 1);
		updateText('avgSolveTime', getReadableTime(avg_solve_time));
	}


    function getPoolTransactions() {
        var xhrGetPool = $.ajax({
            url: api + '/json_rpc',
            method: "POST",
            data: JSON.stringify({
                jsonrpc:"2.0",
                id: "test",
                method:"f_on_transactions_pool_json",
                params: {}
            }),
            dataType: 'text',
            cache: 'false',
            success: function(data) {
                var txsRows = document.getElementById('mem_pool_rows');
                while (txsRows.firstChild) {
                    txsRows.removeChild(txsRows.firstChild);
                }

                var rawTxs = data.split('"transactions":').pop();
                rawTxs = rawTxs.split('}}')[0];
                var transactions = JSON.parse(rawTxs);
                var txsArray = [];
                txsArray = rawTxs.split('\n\n');
                for(var tx in transactions) {
                    var hash = transactions[tx].hash;
                    if(hash != "") {
                        var amount = transactions[tx].amount_out;
                        var fee = transactions[tx].fee;
                        var size = transactions[tx].size;
                        var row = document.createElement('tr');
                        var timestamp = Date().now; // this is not yet part of the json that gets returned in f_transactions_pool_json, leave for now
                        var columns =
                        /*    '<td>' + formatDate(timestamp) + ' (<span class="mtx-ago"></span>)' + '</td>' + */
                            '<td>' + getReadableCoins(amount, 4, true) + '</td>' +
                            '<td>' + getReadableCoins(fee, 4, true) + '</td>' +
                            '<td>' + localizeNumber(size) + '</td>' +
                            '<td>' + formatPaymentLink(hash) + '</td>';
                        row.innerHTML = columns;
                        $(txsRows).append(row);
                    //    $(row).find('.mtx-ago').timeago('update', new Date(timestamp * 1000).toISOString());  We can re-enable this after a timestamp is added to the mem_pool json
                    }
                }
                updateText('mempool_count', document.querySelectorAll('#mem_pool_rows tr').length);
            },
            error: function(data) { }
        });
    };

// {XFG} MemPool Transactions
// function getPoolTransactions(){
//  var xhrGetPool = $.ajax({
//	url: api + '/json_rpc',
//	method: "POST",
//	data: JSON.stringify({
//		jsonrpc: "2.0",
//		id: "test",
//		method: "f_mempool_json",
//		params: {}
//	}),
//	dataType: 'json',
//	cache: 'false',
//	success: function(newdata) {
//		if(typeof newdata.result !== "undefined") {
//			var data = newdata.result.mempool;
//			var totalAmount = 0;
//			var totalFee = 0;
//			var totalSize = 0;
//			var txcount = 0;
//			var txsRows = document.getElementById('mem_pool_rows');
//			  if (txsRows) {
//				while (txsRows.firstChild) {
//				  txsRows.removeChild(txsRows.firstChild);
//				}
//			  }
//			for (var i = 0; i < data.length; i ++){
//				var tx = data[i];
//					
//				var row = document.createElement('tr');
//				var columns =
//					'<td>' + formatDate(tx.receiveTime) + ' (<span class="mtx-ago"></span>)' + '</td>' +
//					'<td>' + getReadableCoins(tx.amount_out, 4, true) + '</td>' +
//					'<td>' + getReadableCoins(tx.fee, 4, true) + '</td>' +
//					'<td>' + formatBytes(parseInt(tx.size)) + '</td>' +
//					'<td>' + formatPaymentLink(tx.hash) + '</td>';
//				row.innerHTML = columns;
//				$(txsRows).append(row);
//				$(row).find('.mtx-ago').timeago('update', new Date(tx.receiveTime * 1000).toISOString());
//				
//				txcount = txcount + 1;
//				totalAmount = tx.amount_out + totalAmount;
//				totalFee = totalFee + tx.fee;
//				totalSize = totalSize + tx.size;
//				
//			}
//			updateText('mempool_count', txcount);
//			updateText('mempool_amount', getReadableCoins(totalAmount,4));
//			updateText('mempool_fees', getReadableCoins(totalFee, 7));
//			updateText('mempool_sizes', formatBytes(parseInt(totalSize)));
//				
//		}
//
//	}
//  });
// } 

// Difficulty chart
function displayDiffChart() {
	var ctx = document.getElementById("difficultyChart").getContext("2d"); 
	var gradientFill = ctx.createLinearGradient(500, 0, 100, 0);

		gradientFill.addColorStop(0, "rgba(255, 200, 0, 1)");
		gradientFill.addColorStop(0.66, "rgba(212, 175, 55, 1)");
		gradientFill.addColorStop(1, "rgba(255, 200, 0, 1)");

	var chartData = {
			labels: [].concat(Blocks).reverse(),
			labels: [].concat(formatDate(Timestamps)).reverse(),
			datasets: [
			  {
				data: [].concat(Blocks).reverse(),
				yAxisID: "Height",
				label: "",
				backgroundColor: "rgba(0,0,0,0)",
				borderColor: 'rgba(0,0,0,0)',
				borderWidth: 0,
				pointBorderWidth: 0,
				pointRadius: 0,
				pointHoverRadius: 0,
				pointHitRadius: 0,
				display: false
			  },{
				data: [].concat(Difficulties).reverse(),
				yAxisID: "Difficulty",
				label: "Difficulty",
				type: "line",
				backgroundColor: 'rgba(0, 0, 255, 0.3)',
				borderColor: '#70f',
				borderWidth: 3,
				pointColor : '#70f',
				pointBorderColor : '#70f',
				pointHighlightFill: '#70f',
				pointBackgroundColor: '#70f',
				pointBorderWidth: 3,
				pointRadius: 1,
				pointHoverRadius: 3,
				pointHitRadius: 20,
				display: true
                          }, {
                                data: [].concat(Txses).reverse(),
                                yAxisID: "Transactions",
				label: "Transactions",
                backgroundColor: "#b0e9ff4d",
                borderColor: "#00bfff",
           		borderWidth: 2,
				pointColor : "#00bfff",
				pointBorderColor : "#00bfff",
				pointHighlightFill: "#00bfff",
				pointBackgroundColor: "#00bfff",
				pointBorderWidth: 3,
				pointRadius: 1,
				pointHoverRadius: 3,
				pointHitRadius: 20
			}, {
                                data: [].concat(Sizes).reverse(),
                                yAxisID: "Sizes",
                                label: "Size",
                                type: "line",  
                                backgroundColor:'',
                                borderColor: '#ffc800',
                                borderWidth: 3,
                                pointBorderWidth: 1,
                                pointRadius: 1,
                                pointHoverRadius: 3,
                                pointHitRadius: 20,
                                display: true
                          }
                    ]
		};
	var options = {
			responsive: true,
			maintainAspectRatio: false,
			elements: {
				line: {
					tension: 0.333
				}
			},
			title: {
				display: true
			},
			legend: {
				display: true
			},
			scales: {
			  yAxes: [
			{
                                id: 'Height',
                                type: 'linear',
                               position: 'left',
                                scaleLabel: {
                                        display: false,
                                        labelString: 'Block'
                                },
                                gridLines: {
                                        display:false
                                },
                               ticks: {
                                        fontSize: 8,
                                        display:false
                                },
                                display: false
			},{
				id: 'Difficulty',
				type: 'linear',
				position: 'right',
				scaleLabel: {
					display: true,
					labelString: 'Difficulty'
				},
				gridLines: {
					display:true
				},
				ticks: {
					fontSize: 15,
					display:true
				},
				display: true
			  },{
				id: 'Transactions',
				type: 'linear',
				position: 'left',
 				barThickness: 30,
				scaleLabel: {
					display: true,
					labelString: 'Transactions'
				},
				gridLines: {
					display:true
				},
				ticks: {
					fontSize: 14,
					display:true
				},
				display: true
			  },{
				id: 'Sizes',
				type: 'linear',
				position: 'left',
				scaleLabel: {
					display: true,
					labelString: 'Size'
				},
				gridLines: {
					display:true
				},
				ticks: {
					fontSize: 14,
					display:true
				},
				display: true
			  }
			  
			  ],
			  xAxes: [{
				type: "time",
				categoryPercentage: 0,
				barPercentage: 1,
				categorySpacing: 0,
				barThickness: 10,
				time: {
                    parser: false,
					unit: 'minute',
					unitStepSize: 60,
					barThickness: 10,
					round: 'second',
					displayFormats: {
                                        'millisecond': 'SSS [ms]',
                                        'second': 'HH:mm:ss', // 11:20:01 AM
                                        'minute': 'HH:mm', // 11:20:01 AM
                                        'hour': 'HH:mm', // Sept 4, 5PM
                                        'day': 'MMM Do', // Sep 4 2015
                                        'week': 'll', // Week 46, or maybe "[W]WW - YYYY" ?
                                        'month': 'MMM YYYY', // Sept 2015
                                        'quarter': '[Q]Q - YYYY', // Q3
                                        'year': 'YYYY', // 2017
                                    },
				},
				gridLines: {
					display:true
				},
				ticks: {
					fontSize: 9,
					fontColor: "#CCC",
					autoSkip: true,
					//maxRotation: 90,
					//minRotation: 90
					//display:false
				}
				//display: false
			  }]
			},
			tooltips: {
				mode: 'index',
				displayColors: true,
				callbacks: {
					title: function(tooltipItem, data) {
					//	var height	= data.datasets[3].data[tooltipItem[0].index];
						var time = new Date(data.labels[tooltipItem[0].index]).toLocaleString();
					//	return 'Block: ' + height + ' - ' + time + '';
						return time + '';
					}, /*
					label: function(tooltipItem, data) { 
				//		var diff		= data.datasets[0].data[tooltipItem.index];
						var txcount	= data.datasets[1].data[tooltipItem.index];
						var size		= data.datasets[2].data[tooltipItem.index];
						
						var diff_swatch_color = data.datasets[0].borderColor;
						
						console.log(diff_swatch_color);
						
				//		var diff_swatch = '<span style="color="'+ diff_swatch_color +'">&bullet;</span>';
						
						var multistringText = [];
  
				//		var str1 = diff_swatch + 'Difficulty: ' + diff + '';
						var str2 = 'Size: ' + size + '';
						var str3 = 'Transactions: ' + txcount + '';
  
				//		multistringText.push(str1);
						multistringText.push(str2);
						multistringText.push(str3);
  
						return multistringText;
					} */
				}
			  }
		}; 
		
	diffChart = new Chart(ctx,{
    type: 'bar',
    data: chartData,
    options: options
	});
}
function refreshChart() {
	var brows   = $('#blocks_rows').children(),
		labels  = [],
		diffs   = [],
		sizes   = [],
		times   = [],
		heights = [],
		txsnr   = [];
		for (var i = 0; i < brows.length; i++) {
			var row = $(brows[i]);
			var label = row.data("json").height;
			var diff  = row.data("json").difficulty;
			var txses = row.data("json").tx_count;
			var size  = row.data("json").cumul_size;
			var time  = row.attr('data-dt');
				labels.push(label);
				diffs.push(diff);
				txsnr.push(txses);
				sizes.push(size);				
				times.push(time);				
		}
		
		diffChart.data.labels = times.reverse();
		diffChart.data.datasets[0].data = labels.reverse();
		diffChart.data.datasets[1].data = diffs.reverse();
		diffChart.data.datasets[2].data = txsnr.reverse();
		diffChart.data.datasets[3].data = sizes.reverse();
		
		diffChart.update();
}	
function loadMoreChart() {
	diffChart.data.labels = [].concat(Blocks).reverse();
	diffChart.data.labels = [].concat(Timestamps).reverse();
	diffChart.data.datasets[0].data = [].concat(Blocks).reverse();
	diffChart.data.datasets[1].data = [].concat(Difficulties).reverse();
	diffChart.data.datasets[2].data = [].concat(Txses).reverse();
	diffChart.data.datasets[3].data = [].concat(Sizes).reverse();
	diffChart.update();
}
$(function() {
    $('[data-toggle="tooltip"]').tooltip();
});
function getReadableTime(seconds){
        var units = [ [60, 's.'], [60, 'min.'], [24, 'h.'],
            [7, 'd.'], [4, 'w.'], [12, 'м.'], [1, 'y.'] ];
        function formatAmounts(amount, unit){
            var rounded = Math.round(amount);
            return '' + rounded + ' ' + unit + (rounded > 1 ? '' : '');
        }
        var amount = seconds;
        for (var i = 0; i < units.length; i++){
            if (amount < units[i][0])
                return formatAmounts(amount, units[i][1]);
            amount = amount / units[i][0];
        }
        return formatAmounts(amount,  units[units.length - 1][1]);
}
function formatBytes(bytes, precision) {
	if (isNaN(parseFloat(bytes)) || !isFinite(bytes)) return '-';
	if (typeof precision === 'undefined') precision = 1;
	var units = ['bytes', 'kB', 'MB', 'GB', 'TB', 'PB'],
		number = Math.floor(Math.log(bytes) / Math.log(1024));
	return (bytes / Math.pow(1024, Math.floor(number))).toFixed(precision) +  ' ' + units[number];
}
  function tra() {
    var x = document.getElementById("tradiv");
    if (x.style.display === "none") {
        x.style.display = "block";
    } else {
        x.style.display = "none";
    }
};
</script>
<script src="../js/Chart.bundle.min.js"></script>
